<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code → GUI (BW) — مولد الشكل المظهري</title>

  <!-- Tailwind (quick) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- html2canvas for export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --bg:#0b0b0b;
      --panel:#0f0f0f;
      --muted:#bdbdbd;
      --white:#ffffff;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg,#000,#0b0b0b 60%);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-y:auto;
    }

    /* subtle animated stripe background for style */
    .bg-stripe {
      background-image: linear-gradient(90deg, rgba(255,255,255,0.02) 0.5px, transparent 0.5px);
      background-size: 12px 12px;
      opacity: 0.03;
      position: fixed; inset:0; z-index:0; pointer-events:none;
    }

    /* layout */
    .app { position: relative; z-index:10; padding:18px; max-width:1200px; margin-inline:auto; }
    header { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .logo {
      display:flex; align-items:center; gap:10px;
    }
    .logo-mark {
      width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
    }

    /* main panels */
    .controls { display:grid; grid-template-columns: 1fr 420px; gap:16px; align-items:start; }
    @media (max-width:900px){ .controls{ grid-template-columns: 1fr; } .right-panel{ order:2 } .left-panel{ order:1 } }

    textarea.code {
      width:100%; height:420px; resize:vertical;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      color:var(--white); padding:12px; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      padding:12px; border-radius:10px;
    }

    /* preview (the GUI mockup) */
    .mockup-wrap { display:flex; gap:10px; flex-direction:column; align-items:center; }
    .mockup {
      width: 360px; max-width:100%; min-height:640px;
      background: #fff; color:#000; border-radius:14px; overflow:hidden; position:relative;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
      border: 1px solid rgba(0,0,0,0.06);
    }

    /* black/white styling inside mockup */
    .mockup * { box-sizing:border-box; }
    .m-topbar { height:56px; display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid rgba(0,0,0,0.06); }
    .m-content { padding:16px; }
    .m-btn { display:inline-block; padding:10px 12px; border-radius:10px; background:#000; color:#fff; font-weight:600; margin:6px 0; }
    .m-card { background:#f9f9f9; border-radius:10px; padding:12px; color:#111; margin:8px 0; border:1px solid rgba(0,0,0,0.06); }
    .m-input { width:100%; padding:10px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); margin:8px 0; background: #fff; color:#111; }

    /* small helper */
    .tag { font-size:12px; padding:6px 8px; border-radius:999px; background:rgba(255,255,255,0.06); color:var(--white); display:inline-block; margin-left:6px; }

    /* export button */
    .export-btn { background:transparent; border:1px solid rgba(255,255,255,0.06); padding:8px 12px; border-radius:8px; color:var(--white); }

    /* hints */
    .hints { color:var(--muted); font-size:13px; margin-top:8px; }

    /* subtle animation for mockup appear */
    .mockup-enter { transform: translateY(8px); opacity:0; transition: all .45s cubic-bezier(.2,.9,.2,1); }
    .mockup-enter.show { transform:none; opacity:1; }

  </style>
</head>
<body>
  <div class="bg-stripe" aria-hidden="true"></div>

  <div class="app">
    <header>
      <div class="logo">
        <div class="logo-mark" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 18L14 6L18 10L10 22L6 18Z" fill="#fff"/></svg></div>
        <div>
          <div style="font-weight:700">Code → GUI</div>
          <div style="font-size:13px;color:var(--muted)">حوّل وصف الـمود / الكود إلى شكل GUI (أسود/أبيض)</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; align-items:center;">
        <div class="tag">نسخة تجريبية</div>
        <button id="exportBtn" class="export-btn" title="تصدير الصورة">تحميل كصورة (PNG)</button>
      </div>
    </header>

    <main class="controls">
      <!-- left: code editor -->
      <div class="left-panel panel">
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
          <label style="font-weight:600;">اختر لغة:</label>
          <select id="langSel" class="rounded-md" style="padding:6px 8px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--white)">
            <!-- languages (expanded) -->
            <option>auto-detect</option>
            <option>html</option>
            <option>css</option>
            <option>javascript</option>
            <option>typescript</option>
            <option>python</option>
            <option>lua</option>
            <option>luau</option>
            <option>c</option>
            <option>cpp</option>
            <option>c#</option>
            <option>java</option>
            <option>php</option>
            <option>go</option>
            <option>rust</option>
            <option>swift</option>
            <option>kotlin</option>
            <option>ruby</option>
            <option>bash</option>
            <option>yaml</option>
            <option>json</option>
          </select>
          <button id="genBtn" class="export-btn" style="margin-inline-start:8px;">✅ تحويل</button>
        </div>

        <textarea id="codeArea" class="code" placeholder="انسخ الكود أو الوصف هنا — مثلاً: 'button:احجز الآن; header:تطبيق حجوزات; list:خدمات'"></textarea>

        <div class="hints">نصيحة: يمكنك كتابة وصف موجز بدل كود (مثلاً: "header: صفحة تسجيل دخول، زر: تسجيل، حقول: اسم وكلمة مرور، صورة لوجو"). المحلل يستخرج عناصر واجهة شائعة ويحوّلها إلى Mockup.</div>
      </div>

      <!-- right: preview -->
      <aside class="right-panel">
        <div class="panel mockup-wrap">
          <div id="mockup" class="mockup mockup-enter" role="img" aria-label="معاينة الشكل المظهري"></div>
          <div style="margin-top:8px; display:flex; gap:8px; justify-content:center;">
            <button id="smallExport" class="export-btn">تحميل عرض صغير</button>
            <button id="resetBtn" class="export-btn">إعادة افتراضية</button>
          </div>
        </div>

        <div style="margin-top:12px;" class="panel">
          <div style="font-weight:700">كيف يعمل المحلل؟</div>
          <ul style="color:var(--muted); margin-top:8px; font-size:13px; line-height:1.5;">
            <li>📌 يبحث عن كلمات مفتاحية للعناصر: header, nav, button, input, form, card, list, img, avatar, hero, footer.</li>
            <li>🛠 يدعم عدة لغات ويستطيع تلقائيًا اكتشاف بعض الأنماط.</li>
            <li>⚠️ هذه محاكاة — ليست ترجمة دقيقة لكود يعمل، لكنها تخطيط بصري مفيد للتصميم.</li>
          </ul>
        </div>
      </aside>
    </main>
  </div>

  <script>
    // Helper: simple language normalization
    const langSel = document.getElementById('langSel');
    const codeArea = document.getElementById('codeArea');
    const genBtn = document.getElementById('genBtn');
    const mockup = document.getElementById('mockup');
    const exportBtn = document.getElementById('exportBtn');
    const smallExport = document.getElementById('smallExport');
    const resetBtn = document.getElementById('resetBtn');

    // Default example
    codeArea.value = `# مثال سريع (يمكنك لصق كود أو وصف)
header: تطبيق حجوزات
nav: الرئيسية, الخدمات, تواصل
hero-title: احجز رحلتك الآن
hero-sub: أفضل الأسعار وخدمة 24/7
button: احجز الآن
card: خدمة المطار, خدمة السائق, تأمين
form: name,email,password,submit
footer: © 2025`;


    // Parser: heuristics to extract UI elements from free text or code
    function parseCodeToSpec(text, lang){
      const spec = { header:null, nav:[], hero:{}, buttons:[], cards:[], form:[], lists:[], images:[], footer:null, extras:[] };

      const lower = text.toLowerCase();

      // If HTML provided, try to parse actual tags
      if(/<\s*html|<\s*div|<\s*button|<\s*header/i.test(text) || lang === 'html'){
        // create a DOM parser and try extract some basic tags
        try {
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const headerTag = doc.querySelector('header') || doc.querySelector('nav') || doc.querySelector('h1');
          if(headerTag) spec.header = headerTag.textContent.trim();
          const btns = doc.querySelectorAll('button, a');
          btns.forEach(b => { const t = b.textContent.trim(); if(t) spec.buttons.push(t); });
          const inputs = doc.querySelectorAll('input, textarea');
          inputs.forEach(i => spec.form.push(i.getAttribute('name')||i.getAttribute('id')||'input'));
          const imgs = doc.querySelectorAll('img');
          imgs.forEach(i => spec.images.push(i.getAttribute('alt')||i.getAttribute('src')||'img'));
          const cards = doc.querySelectorAll('.card, .panel, article');
          cards.forEach(c => { spec.cards.push((c.querySelector('h3')||c.querySelector('h2')||{textContent:'Card'}).textContent.trim()); });
        } catch(e){}
      }

      // quick keyword maps for many languages / free text
      const keymap = [
        {k:/header\s*:\s*([^\n,;]+)/i, f:(m)=> spec.header = m[1].trim()},
        {k:/nav\s*:\s*([^\n;]+)/i, f:(m)=> spec.nav = m[1].split(/[,;]/).map(s=>s.trim()).filter(Boolean)},
        {k:/hero-title\s*:\s*([^\n;]+)/i, f:(m)=> spec.hero.title = m[1].trim()},
        {k:/hero-sub\s*:\s*([^\n;]+)/i, f:(m)=> spec.hero.sub = m[1].trim()},
        {k:/button\s*:\s*([^\n;]+)/i, f:(m)=> spec.buttons.push(m[1].trim())},
        {k:/card\s*:\s*([^\n;]+)/i, f:(m)=> spec.cards = spec.cards.concat(m[1].split(/[,;]/).map(s=>s.trim()))},
        {k:/form\s*:\s*([^\n;]+)/i, f:(m)=> spec.form = spec.form.concat(m[1].split(/[,;]/).map(s=>s.trim()))},
        {k:/footer\s*:\s*([^\n;]+)/i, f:(m)=> spec.footer = m[1].trim()},
        {k:/list\s*:\s*([^\n;]+)/i, f:(m)=> spec.lists.push(m[1].split(/[,;]/).map(s=>s.trim()))},
        {k:/img\s*:\s*([^\n;]+)/i, f:(m)=> spec.images.push(m[1].trim())},
      ];

      for(const rule of keymap){
        let match;
        while((match = rule.k.exec(text)) !== null){
          try { rule.f(match); } catch(e){}
          // prevent infinite loops for global regex; break if not global
          if(!rule.k.global) break;
        }
      }

      // generic heuristics: find UI words in code (english/common tokens)
      const tokens = text.match(/(button|btn|submit|login|register|nav|menu|header|footer|card|input|form|search|list|item|carousel|hero|banner)/gi) || [];
      if(tokens.length > 0){
        // add a button if none found
        if(spec.buttons.length === 0) spec.buttons.push('تأكيد');
      }

      // fallback: derive title from first H1-like or comment
      const h1 = text.match(/(?:^|\n)\s*#\s*(.+)/) || text.match(/<h1[^>]*>([^<]+)/i) || text.match(/(?:^|\n)\s*title\s*[:=]\s*(.+)/i);
      if(h1 && !spec.header) spec.header = h1[1].trim();

      return spec;
    }

    // Renderer: build DOM inside mockup based on spec
    function renderMockup(spec){
      // clear
      mockup.innerHTML = '';
      mockup.classList.add('mockup-enter'); setTimeout(()=> mockup.classList.add('show'),20);

      // topbar
      const topbar = document.createElement('div'); topbar.className = 'm-topbar';
      const left = document.createElement('div'); left.style.display='flex'; left.style.alignItems='center'; left.style.gap='10px';
      const mark = document.createElement('div'); mark.style.width='36px'; mark.style.height='36px'; mark.style.borderRadius='8px'; mark.style.background='#111'; mark.style.display='flex'; mark.style.alignItems='center'; mark.style.justifyContent='center';
      mark.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 18L14 6L18 10L10 22L6 18Z" fill="#fff"/></svg>';
      left.appendChild(mark);
      const title = document.createElement('div'); title.style.fontWeight='700'; title.style.fontSize='15px'; title.textContent = spec.header || 'تطبيق جديد';
      left.appendChild(title);
      topbar.appendChild(left);

      const right = document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';
      if(spec.nav && spec.nav.length){
        spec.nav.slice(0,3).forEach(n=>{
          const t = document.createElement('div'); t.style.fontSize='13px'; t.style.color='#222'; t.style.background='#fff'; t.style.padding='6px 8px'; t.style.borderRadius='8px'; t.textContent = n; right.appendChild(t);
        });
      } else {
        const t = document.createElement('div'); t.style.fontSize='13px'; t.style.color='#222'; t.style.background='#fff'; t.style.padding='6px 8px'; t.style.borderRadius='8px'; t.textContent = 'الرئيسية'; right.appendChild(t);
      }
      topbar.appendChild(right);
      mockup.appendChild(topbar);

      // content
      const content = document.createElement('div'); content.className='m-content';

      // hero
      if(spec.hero && (spec.hero.title || spec.hero.sub || spec.buttons.length)){
        const hero = document.createElement('div'); hero.style.marginBottom='10px';
        const hTitle = document.createElement('div'); hTitle.style.fontSize='18px'; hTitle.style.fontWeight='800'; hTitle.textContent = spec.hero.title || 'عنوان رئيسي';
        const hSub = document.createElement('div'); hSub.style.color='#444'; hSub.style.marginTop='6px'; hSub.textContent = spec.hero.sub || 'وصف موجز للمحتوى';
        hero.appendChild(hTitle); hero.appendChild(hSub);

        // buttons
        const bwrap = document.createElement('div'); bwrap.style.marginTop='10px';
        (spec.buttons.length ? spec.buttons : ['ابدأ الآن']).slice(0,2).forEach(b=>{
          const bb = document.createElement('span'); bb.className='m-btn'; bb.style.marginInlineEnd='8px'; bb.textContent = b;
          bwrap.appendChild(bb);
        });
        hero.appendChild(bwrap);
        content.appendChild(hero);
      }

      // form
      if(spec.form && spec.form.length){
        const form = document.createElement('div'); form.style.marginTop='8px';
        spec.form.slice(0,5).forEach(f=>{
          const input = document.createElement('input'); input.className='m-input'; input.placeholder = f || 'حقل';
          form.appendChild(input);
        });
        const s = document.createElement('div'); s.className='m-btn'; s.textContent = (spec.form.includes('submit')? 'إرسال' : 'تسجيل');
        s.style.display='inline-block'; s.style.marginTop='8px';
        form.appendChild(s);
        content.appendChild(form);
      }

      // cards
      if(spec.cards && spec.cards.length){
        const grid = document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='1fr 1fr'; grid.style.gap='8px'; grid.style.marginTop='12px';
        spec.cards.slice(0,6).forEach(c=>{
          const card = document.createElement('div'); card.className='m-card';
          const ch = document.createElement('div'); ch.style.fontWeight='700'; ch.textContent = c;
          const cd = document.createElement('div'); cd.style.color='#333'; cd.style.marginTop='6px'; cd.textContent = 'وصف بسيط للخدمة أو العنصر.';
          card.appendChild(ch); card.appendChild(cd);
          grid.appendChild(card);
        });
        content.appendChild(grid);
      }

      // lists
      if(spec.lists && spec.lists.length){
        spec.lists.forEach(lst=>{
          const ul = document.createElement('ul'); ul.style.marginTop='12px';
          lst.slice(0,6).forEach(it=>{
            const li = document.createElement('li'); li.style.padding='8px 6px'; li.style.borderBottom='1px solid rgba(0,0,0,0.03)'; li.textContent = it;
            ul.appendChild(li);
          });
          content.appendChild(ul);
        });
      }

      // images
      if(spec.images && spec.images.length){
        const img = document.createElement('div'); img.style.height='120px'; img.style.borderRadius='8px'; img.style.background='#eee'; img.style.display='flex'; img.style.alignItems='center'; img.style.justifyContent='center'; img.style.color='#222'; img.textContent = spec.images[0];
        content.appendChild(img);
      }

      // fallback small message if nothing found
      if(!spec.header && !spec.hero.title && spec.cards.length===0 && spec.form.length===0 && spec.buttons.length===0){
        const note = document.createElement('div'); note.style.color='#333'; note.style.background='#fff'; note.style.padding='10px'; note.style.borderRadius='8px'; note.textContent = 'لا توجد عناصر واجهة قابلة للاستخلاص — جرّب كتابة وصف أقصر مثل: "header:تطبيق, button:ابدأ, form:name,email"';
        content.appendChild(note);
      }

      mockup.appendChild(content);

      // footer inside mockup
      const foot = document.createElement('div'); foot.style.marginTop='auto'; foot.style.padding='12px'; foot.style.borderTop='1px solid rgba(0,0,0,0.04)'; foot.style.display='flex'; foot.style.justifyContent='space-between'; foot.style.alignItems='center';
      const leftf = document.createElement('div'); leftf.style.fontSize='13px'; leftf.style.color='#222'; leftf.textContent = spec.footer || '© 2025';
      const rightf = document.createElement('div'); rightf.style.fontSize='12px'; rightf.style.color='#666'; rightf.textContent = 'Mockup · BW';
      foot.appendChild(leftf); foot.appendChild(rightf);
      mockup.appendChild(foot);

      // set background color in monotone
      mockup.style.background = '#fff';
      mockup.style.color = '#000';
    }

    // generate action
    genBtn.addEventListener('click', ()=>{
      const text = codeArea.value || '';
      const lang = (langSel.value || '').toLowerCase();
      const spec = parseCodeToSpec(text, lang);
      renderMockup(spec);
    });

    // initial render
    genBtn.click();

    // export full mockup (PNG)
    async function exportPNG(scale=2){
      // temporarily remove entrance class to avoid opacity transition
      mockup.classList.remove('mockup-enter','show');
      const origWidth = mockup.offsetWidth;
      const origHeight = mockup.offsetHeight;
      // clone node to avoid overlays
      const clone = mockup.cloneNode(true);
      clone.style.transform = 'none';
      clone.style.margin = '0';
      clone.style.position = 'relative';
      clone.style.left = '0';
      clone.style.top = '0';
      clone.style.boxShadow = 'none';
      const wrapper = document.createElement('div');
      wrapper.style.width = origWidth + 'px';
      wrapper.style.height = origHeight + 'px';
      wrapper.style.display = 'inline-block';
      wrapper.appendChild(clone);
      document.body.appendChild(wrapper);
      // use html2canvas
      const canvas = await html2canvas(wrapper, { scale: scale, backgroundColor: null, useCORS:true, logging:false });
      const url = canvas.toDataURL('image/png');
      // cleanup
      document.body.removeChild(wrapper);
      mockup.classList.add('mockup-enter','show');
      // download
      const a = document.createElement('a'); a.href = url; a.download = 'mockup.png'; document.body.appendChild(a); a.click(); a.remove();
    }

    exportBtn.addEventListener('click', ()=> exportPNG(2));
    smallExport.addEventListener('click', ()=> exportPNG(1));

    resetBtn.addEventListener('click', ()=>{
      codeArea.value = `# مثال سريع (يمكنك لصق كود أو وصف)
header: تطبيق حجوزات
nav: الرئيسية, الخدمات, تواصل
hero-title: احجز رحلتك الآن
hero-sub: أفضل الأسعار وخدمة 24/7
button: احجز الآن
card: خدمة المطار, خدمة السائق, تأمين
form: name,email,password,submit
footer: © 2025`;
      genBtn.click();
    });

    // small UX: Ctrl/Cmd+Enter to generate
    codeArea.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); genBtn.click(); }
    });

  </script>
</body>
</html>
